const tambahBtn=document.getElementById("tambah-btn"),cariBtn=document.getElementById("cari-btn"),judul=document.getElementById("judul"),penulis=document.getElementById("penulis"),tahun=document.getElementById("tahun"),selesai=document.querySelector("#selesai"),blmSelesaiDiv=document.getElementById("blm-selesai-div"),selesaiDiv=document.getElementById("selesai-div"),tambahForm=document.querySelector("form"),cariForm=document.querySelector("form:nth-of-type(2)"),pindahBtn=document.querySelectorAll(".pindah-btn"),cariJudul=document.getElementById("cariJudul"),modal=document.getElementById("modal"),key="buku",btnClose=document.querySelectorAll(".modal-footer .btn-success, .btn-close"),btnSave=document.querySelector(".modal-footer .btn-danger");function updateRak(e){const t=JSON.parse(localStorage.getItem(key)),a=t.map((e=>{const t=document.createElement("div");t.classList.add("card","p-2","mb-3");const a=document.createElement("ul");a.classList.add("list-group-flush","px-2");const n=["title","author","year"];for(let t of n){const n=document.createElement("li");n.innerHTML=e[t],n.classList.add("list-group-item"),a.append(n)}return a.firstElementChild.classList.add("card-title"),a.children[1].prepend("Penulis: "),a.children[2].prepend("Tahun Terbit: "),a.children[2].classList.add("border-bottom-0","mb-1"),a.append(bukuBtn(e.id,e.isComplete)),t.append(a),t}));blmSelesaiDiv.innerHTML="";let n=document.createElement("h3");if(n.innerHTML="Belum selesai dibaca",n.classList.add("text-center","text-primary","mb-4"),blmSelesaiDiv.append(n),selesaiDiv.innerHTML="",n=document.createElement("h3"),n.innerHTML="Selesai dibaca",n.classList.add("text-center","text-primary","mb-4"),selesaiDiv.append(n),a.forEach(((e,a)=>{if(t[a].isComplete)return selesaiDiv.append(e);blmSelesaiDiv.append(e)})),e){a.forEach((e=>e.classList.add("d-none")));let t=document.querySelectorAll(".card-title");t=Array.from(t);return t.filter((e=>e.innerHTML.includes(cariJudul.value))).forEach((e=>e.parentElement.parentElement.classList.remove("d-none"))),kosong(!0,e),void kosong(!1,e)}kosong(!0),kosong(!1)}function kosong(e,t){const a=t||JSON.parse(localStorage.getItem(key)),n=document.createElement("div");n.classList.add("d-flex","flex-row","justify-content-center","align-items-center");const l=document.createElement("img");l.setAttribute("src","../assets/empty-state.png"),l.classList.add("col-6");const d=document.createElement("p");d.classList.add("col-6"),d.innerText="Tidak ada buku",n.append(l),n.append(d),a.filter((t=>t.isComplete===e)).length<1&&(e?selesaiDiv.append(n):blmSelesaiDiv.append(n))}function bukuBtn(e,t){const a=JSON.parse(localStorage.getItem(key)),n=document.createElement("li");n.classList.add("btn-group");const l=document.createElement("button");l.classList.add("btn","btn-success","pindah-btn"),l.innerHTML=t?"Belum dibaca":"Sudah dibaca";const d=document.createElement("button");return d.classList.add("btn","btn-danger","hapus-btn"),d.innerHTML="Hapus",n.append(l,d),l.addEventListener("click",(()=>{const t=a.filter((t=>t.id==e));t[0].isComplete=!t[0].isComplete,localStorage.setItem(key,JSON.stringify(a)),updateRak()})),d.addEventListener("click",(()=>{toggleModal(!0)})),btnSave.addEventListener("click",(()=>{const t=a.filter((t=>t.id!=e));localStorage.setItem(key,JSON.stringify(t)),toggleModal(),updateRak()})),n}function toggleModal(e){if(e)return modal.style.display="block",modal.classList.add("show"),modal.style.background="rgba(0, 0, 0, 0.5)",void document.body.classList.add("modal-open");modal.style.display="",modal.classList.remove("show"),modal.style.background="",document.body.classList.remove("modal-open")}btnClose.forEach((e=>e.addEventListener("click",(()=>toggleModal())))),null!==localStorage.getItem(key)&&updateRak(),tambahForm.addEventListener("submit",(e=>{if(e.preventDefault(),e.target.classList.add("was-validated"),!tambahForm.checkValidity())return;const t={id:+new Date,title:judul.value,author:penulis.value,year:tahun.value,isComplete:selesai.checked};if(null===localStorage.getItem(key))return localStorage.setItem(key,JSON.stringify([t])),updateRak();const a=JSON.parse(localStorage.getItem(key));a.push(t),localStorage.setItem(key,JSON.stringify(a)),updateRak()})),cariForm.addEventListener("submit",(e=>{if(e.preventDefault(),null===localStorage.getItem(key)||!cariJudul.value)return updateRak();updateRak(JSON.parse(localStorage.getItem(key)).filter((e=>e.title.includes(cariJudul.value))))}));
